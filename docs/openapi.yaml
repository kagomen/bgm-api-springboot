openapi: 3.0.0
info:
  title: BGM API
  version: 1.0.0
  description: |
    - â˜…ãƒãƒ¼ã‚¯ã®ã¤ã„ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å®Ÿè£…ã®å„ªå…ˆåº¦ãŒä½ã„
    - ğŸ”“ã‚¢ã‚¤ã‚³ãƒ³ã®ã¤ã„ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ä½¿ç”¨å¯
      - ãã®ä»–ã®ãƒ­ãƒ¼ãƒ«æ¨©é™ãŒã‚ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ã€‘å†…ã«ãã®æ—¨ã‚’è¨˜è¿°

servers:
  - url: http://localhost:8080

paths:
  /bgm:
    get:
      summary: BGMä¸€è¦§ã‚’å–å¾—ãƒ»ã‚¿ã‚°æ¤œç´¢
      tags: [bgm]
      parameters:
        - name: tags
          in: query
          description: ã‚¿ã‚°æ¤œç´¢ç”¨ã‚¯ã‚¨ãƒª(å°æ–‡å­—ã®è‹±å­—ã®ã¿ã€è¤‡æ•°ã®å ´åˆã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‹)
          required: false
          schema:
            type: array
            items:
              type: string
            example: ["rain", "cafe"]
          explode: false # tags=rain,cafe ã¨ã™ã‚‹ã®ã«å¿…è¦ãªè¨­å®š
      responses:
        "200":
          description: BGMä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/BgmResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"

    post:
      summary: BGMã‚’æŠ•ç¨¿
      tags: [bgm]
      description: |
        æŠ•ç¨¿è€…ãƒ‡ãƒ¼ã‚¿(createdBy)ã¯JWTãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚µãƒ¼ãƒå´ã§åˆ¤åˆ¥ã™ã‚‹ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«ã¯å«ã‚ãªã„
      security:
        - firebase: []
      x-roles:
        - USER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BgmRequest"
      responses:
        "201":
          description: BGMã‚’æŠ•ç¨¿ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"

  /bgm/{id}:
    get:
      summary: æŒ‡å®šã—ãŸBGMã®æƒ…å ±ã‚’å–å¾—
      tags: [bgm]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: BGMã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    $ref: "#/components/schemas/BgmResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"
    delete:
      summary: æŒ‡å®šã—ãŸBGMã‚’å‰Šé™¤ã€æŠ•ç¨¿ãƒ¦ãƒ¼ã‚¶ã¨ç®¡ç†è€…ã®ã¿ã€‘â˜…
      tags: [bgm]
      security:
        - firebase: []
      x-roles:
        - OWNER
        - ADMIN
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: integer
      responses:
        "204":
          description: æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /bookmark:
    get:
      summary: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ã‚’å–å¾—ãƒ»ã‚¿ã‚°æ¤œç´¢
      tags: [bookmark]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: tags
          in: query
          description: ã‚¿ã‚°æ¤œç´¢ç”¨ã‚¯ã‚¨ãƒª(å°æ–‡å­—ã®è‹±å­—ã®ã¿ã€è¤‡æ•°ã®å ´åˆã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‹)
          required: false
          schema:
            type: array
            items:
              type: string
            example: ["rain", "cafe"]
          explode: false
      responses:
        "200":
          description: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/BgmResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"
    post:
      summary: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«ç™»éŒ²
      tags: [bookmark]
      security:
        - firebase: []
      x-roles:
        - USER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BookmarkRequest"
      responses:
        "201":
          description: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /bookmark/{bgmId}:
    delete:
      summary: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®å‰Šé™¤
      tags: [bookmark]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: bgmId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /tag:
    get:
      summary: åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚°ä¸€è¦§ã‚’å–å¾—
      tags: [tag]
      responses:
        "200":
          description: ã‚¿ã‚°ä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/TagResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"

  /bgm/{id}/tag:
    post:
      summary: æŒ‡å®šã—ãŸBGMã«ã‚¿ã‚°ã‚’è¿½åŠ 
      tags: [tag]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TagRequest"
      responses:
        "201":
          description: ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /report:
    get:
      summary: é•åå ±å‘Šä¸€è¦§ã‚’å–å¾—ã€ç®¡ç†è€…ã®ã¿ã€‘â˜…
      tags: [report]
      security:
        - firebase: []
      x-roles:
        - ADMIN
      responses:
        "200":
          description: å ±å‘Šä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ReportResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
    post:
      summary: é•åBGMã‚’é€šå ±â˜…
      tags: [report]
      security:
        - firebase: []
      x-roles:
        - USER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReportRequest"
      responses:
        "201":
          description: é•åå ±å‘Šã‚’é€ä¿¡ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

components:
  schemas:
    # ==================== ãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨ã‚¹ã‚­ãƒ¼ãƒ ====================

    BgmRequest:
      type: object
      required:
        - title
        - url
      properties:
        title:
          type: string
        url:
          type: string
          format: uri
        tags:
          type: array
          items:
            type: string
          example: ["rain", "cafe"]

    TagRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          example: "happy"

    BookmarkRequest:
      type: object
      required:
        - bgmId
      properties:
        bgmId:
          type: integer

    ReportRequest:
      type: object
      required:
        - bgmId
        - reason
      properties:
        bgmId:
          type: integer
        reason:
          type: string

    # ==================== ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã‚¹ã‚­ãƒ¼ãƒ ====================

    BgmResponse:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        url:
          type: string
          format: uri
        createdAt:
          type: string
          format: date-time
        tags:
          type: array
          items:
            type: string

    TagResponse:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string

    ReportResponse:
      type: object
      properties:
        id:
          type: integer
        bgmId:
          type: integer
        reportedBy:
          type: string
        reason:
          type: string
        createdAt:
          type: string
          format: date-time

  responses:
    # ==================== ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã‚¹ã‚­ãƒ¼ãƒ ====================

    BadRequestResponse:
      description: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™

    UnauthorizedResponse:
      description: èªè¨¼ãŒå¿…è¦ã§ã™
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: èªè¨¼ãŒå¿…è¦ã§ã™

    ForbiddenResponse:
      description: æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“

    NotFoundResponse:
      description: è©²å½“ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: è©²å½“ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“

  securitySchemes:
    firebase:
      type: http
      scheme: bearer
      bearerFormat: JWT
