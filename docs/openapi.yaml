openapi: 3.0.0
info:
  title: BGM API
  version: 1.0.0
  description: |
    - â˜…ã®ã¤ã„ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å®Ÿè£…ã®å„ªå…ˆåº¦ä½
    - ğŸ”“ã®ã¤ã„ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ä½¿ç”¨å¯
      - ãã®ä»–ã®ãƒ­ãƒ¼ãƒ«æ¨©é™ãŒã‚ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ã€‘å†…ã«ãã®æ—¨ã‚’è¨˜è¿°

servers:
  - url: http://localhost:8080

paths:
  /update_user:
    patch:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å¤‰æ›´
      tags: [user]
      description: |
        æŠ•ç¨¿è€…ãƒ‡ãƒ¼ã‚¿(userId)ã¯JWTãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚µãƒ¼ãƒå´ã§åˆ¤åˆ¥ã™ã‚‹ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«ã¯å«ã‚ãªã„
      security:
        - firebase: []
      x-roles:
        - USER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRequest"
      responses:
        "200":
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å¤‰æ›´ã—ã¾ã—ãŸ

  /ban_user/{userId}:
    patch:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®BANï¼ˆè«–ç†å‰Šé™¤ï¼‰ã€ç®¡ç†è€…ã®ã¿ã€‘â˜…
      tags: [user]
      description: |
        ã‚¢ã‚«ã‚¦ãƒ³ãƒˆBANç”¨
      security:
        - firebase: []
      x-roles:
        - ADMIN
      responses:
        "200":
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’BANã—ã¾ã—ãŸ

  /get_bgm_list:
    get:
      summary: BGMä¸€è¦§ã‚’å–å¾—(ã‚¿ã‚°æ¤œç´¢)
      tags: [bgm]
      parameters:
        - name: tags
          in: query
          description: ã‚¿ã‚°æ¤œç´¢ç”¨ã‚¯ã‚¨ãƒª(å°æ–‡å­—ã®è‹±å­—ã®ã¿ã€è¤‡æ•°ã®å ´åˆã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‹)
          required: false
          schema:
            type: array
            items:
              type: string
            example: ["rain", "cafe"]
          style: form
          explode: false # tags=rain,cafe ã¨ã™ã‚‹ã®ã«å¿…è¦ãªè¨­å®š
      responses:
        "200":
          description: BGMä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/BgmResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"

  /get_bgm/{bgmId}:
    get:
      summary: æŒ‡å®šã—ãŸBGMã®æƒ…å ±ã‚’å–å¾—
      tags: [bgm]
      parameters:
        - name: bgmId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: BGMã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    $ref: "#/components/schemas/BgmResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /post_bgm:
    post:
      summary: BGMã‚’æŠ•ç¨¿
      tags: [bgm]
      description: |
        æŠ•ç¨¿è€…ãƒ‡ãƒ¼ã‚¿(userId)ã¯JWTãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚µãƒ¼ãƒå´ã§åˆ¤åˆ¥ã™ã‚‹ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«ã¯å«ã‚ãªã„
      security:
        - firebase: []
      x-roles:
        - USER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BgmRequest"
      responses:
        "201":
          description: BGMã‚’æŠ•ç¨¿ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"

  /delete_bgm/{bgmId}:
    patch:
      summary: æŒ‡å®šã—ãŸBGMã‚’è«–ç†å‰Šé™¤ã€æŠ•ç¨¿ãƒ¦ãƒ¼ã‚¶ã¨ç®¡ç†è€…ã®ã¿ã€‘â˜…
      tags: [bgm]
      security:
        - firebase: []
      x-roles:
        - OWNER
        - ADMIN
      parameters:
        - name: bgmId
          required: true
          in: path
          schema:
            type: integer
      responses:
        "204":
          description: æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /get_tag_list:
    get:
      summary: åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚°ä¸€è¦§ã‚’å–å¾—
      tags: [tag]
      responses:
        "200":
          description: ã‚¿ã‚°ä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/TagResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"

  /add_tag/{bgmId}:
    post:
      summary: æŒ‡å®šã—ãŸBGMã«ã‚¿ã‚°ã‚’è¿½åŠ 
      tags: [tag]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: bgmId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TagAddRequest"
      responses:
        "201":
          description: ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /remove_tag/{bgmId}/{tagId}:
    delete:
      summary: æŒ‡å®šã—ãŸBGMã‹ã‚‰æŒ‡å®šã—ãŸã‚¿ã‚°ã‚’ç‰©ç†å‰Šé™¤
      description: ã‚¿ã‚°ã¯è¤‡æ•°å€‹åŒæ™‚ã«å‰Šé™¤ã§ããªã„
      tags: [tag]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: bgmId
          in: path
          required: true
          schema:
            type: integer
        - name: tagId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /get_bookmark_list:
    get:
      summary: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ã‚’å–å¾—(ã‚¿ã‚°æ¤œç´¢)
      tags: [bookmark]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: tags
          in: query
          description: ã‚¿ã‚°æ¤œç´¢ç”¨ã‚¯ã‚¨ãƒª(å°æ–‡å­—ã®è‹±å­—ã®ã¿ã€è¤‡æ•°ã®å ´åˆã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‹)
          required: false
          schema:
            type: array
            items:
              type: string
            example: ["rain", "cafe"]
          style: form
          explode: false
      responses:
        "200":
          description: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/BgmResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /add_bookmark/{bgmId}:
    post:
      summary: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«ç™»éŒ²
      tags: [bookmark]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: bgmId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "201":
          description: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /delete_bookmark/{bgmId}:
    delete:
      summary: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ç‰©ç†å‰Šé™¤
      tags: [bookmark]
      security:
        - firebase: []
      x-roles:
        - USER
      parameters:
        - name: bgmId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

  /get_report_list:
    get:
      summary: é•åå ±å‘Šä¸€è¦§ã‚’å–å¾—ã€ç®¡ç†è€…ã®ã¿ã€‘â˜…
      tags: [report]
      security:
        - firebase: []
      x-roles:
        - ADMIN
      responses:
        "200":
          description: å ±å‘Šä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuccess:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ReportResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"

  /post_report:
    post:
      summary: é•åBGMã‚’é€šå ±â˜…
      tags: [report]
      security:
        - firebase: []
      x-roles:
        - USER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReportRequest"
      responses:
        "201":
          description: é•åå ±å‘Šã‚’é€ä¿¡ã—ã¾ã—ãŸ
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedResponse"
        "403":
          $ref: "#/components/responses/ForbiddenResponse"
        "404":
          $ref: "#/components/responses/NotFoundResponse"

components:
  schemas:
    # ==================== ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ ====================
    UserRequest:
      type: object
      required:
        - name:
      properties:
        name:
          type: string
          example: Kagome

    BgmRequest:
      type: object
      required:
        - title
        - url
      properties:
        title:
          type: string
          example: é›¨ã®æ—¥ã®ã‚«ãƒ•ã‚§ã®BGM
        url:
          type: string
          format: uri
          example: https://www.youtube.com/watch?v=pPN_t-oEjvI
        tags:
          type: array
          items:
            type: string
          example: ["rain", "cafe"]

    TagAddRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          example: "happy"

    ReportRequest:
      type: object
      required:
        - bgmId
        - reason
      properties:
        bgmId:
          type: integer
          example: 123
        reason:
          type: string
          example: ã‚¤ã‚¿ã‚ºãƒ©æŠ•ç¨¿ã ã¨åˆ¤æ–­ã—ãŸãŸã‚

    # ==================== ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ ====================

    BgmResponse:
      type: object
      properties:
        id:
          type: integer
          example: 123
        title:
          type: string
          example: é›¨ã®æ—¥ã®ã‚«ãƒ•ã‚§ã®BGM
        url:
          type: string
          format: uri
          example: https://www.youtube.com/watch?v=pPN_t-oEjvI
        tags:
          type: array
          items:
            $ref: "#/components/schemas/TagResponse"
        userId:
          type: string
          example: 8
        createdAt:
          type: string
          format: date-time

    TagResponse:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
      example:
        - id: 1
          title: "rain"
        - id: 2
          title: "cafe"

    ReportResponse:
      type: object
      properties:
        id:
          type: integer
          example: 4
        bgmId:
          type: integer
          example: 123
        userId:
          type: string
          example: 8
        reason:
          type: string
          example: ã‚¤ã‚¿ã‚ºãƒ©æŠ•ç¨¿ã ã¨åˆ¤æ–­ã—ãŸãŸã‚
        createdAt:
          type: string
          format: date-time

  responses:
    # ==================== ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ====================

    BadRequestResponse:
      description: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™

    UnauthorizedResponse:
      description: èªè¨¼ãŒå¿…è¦ã§ã™
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: èªè¨¼ãŒå¿…è¦ã§ã™

    ForbiddenResponse:
      description: æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“

    NotFoundResponse:
      description: è©²å½“ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“
      content:
        application/json:
          schema:
            type: object
            properties:
              isSuccess:
                type: boolean
                example: false
              message:
                type: string
                example: è©²å½“ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“

    # ==================== èªè¨¼è¨­å®š ====================

  securitySchemes:
    firebase:
      type: http
      scheme: bearer
      bearerFormat: JWT
